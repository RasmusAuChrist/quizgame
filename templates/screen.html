<body>
  <h1 id="player">üéÆ Ready to play?</h1>

  <div id="qr">
    <p>Scan this QR code to join</p>
    <img src="https://api.qrserver.com/v1/create-qr-code/?data=https://quizgame-4em0.onrender.com/phone&size=200x200" />
  </div>

  <div id="questionBox" style="display:none;">
    <h2 id="questionText"></h2>
    <div id="choices"></div>
    <div id="timer">Score: 100</div>
  </div>

  <div id="leaderboard" style="display:none;"></div>

  <script>
    const socket = io();
    let timerInterval;
    let scoreLeft = 100;

    socket.on("player_joined", (data) => {
      document.getElementById("player").innerText = `Player: ${data.name} joined!`;
      document.getElementById("qr").style.display = "none";
    });

    socket.on("show_question", (data) => {
      document.getElementById("leaderboard").style.display = "none";
      document.getElementById("questionBox").style.display = "block";
      document.getElementById("questionText").innerText = data.question.question;

      const choices = data.question.choices;
      const letters = ["A", "B", "C", "D"];
      const choicesDiv = document.getElementById("choices");
      choicesDiv.innerHTML = "";

      for (let i = 0; i < choices.length; i++) {
        const div = document.createElement("div");
        div.className = "choice";
        div.innerText = `${letters[i]}) ${choices[i]}`;
        choicesDiv.appendChild(div);
      }

      clearInterval(timerInterval);
      scoreLeft = 100;
      timerInterval = setInterval(() => {
        scoreLeft--;
        document.getElementById("timer").innerText = `Score: ${scoreLeft}`;
        if (scoreLeft <= 0) clearInterval(timerInterval);
      }, 100);
    });

    socket.on("game_over", (data) => {
      document.getElementById("questionBox").style.display = "none";

      const lb = data.leaderboard;
      const currentPlayer = data.player;
      const container = document.getElementById("leaderboard");
      container.style.display = "block";

      container.innerHTML = `
        <h2>üèÅ Final Score: ${data.score}</h2>
        <h3>Leaderboard</h3>
        <ol>
          ${lb.map(entry => {
            const isCurrent = entry.name === currentPlayer && entry.score === data.score;
            return `<li${isCurrent ? ' style="color: gold; font-weight: bold;"' : ''}>${entry.name} - ${entry.score}</li>`;
          }).join("")}
        </ol>
        <p>Resetting in a few seconds...</p>
      `;
    });

    socket.on("reset_game", () => {
      window.location.reload();
    });
  </script>
</body>
